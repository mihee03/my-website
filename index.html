<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지하철 통합 웹사이트</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7fa;
            color: #333;
        }

        header {
            background-color: #6c63ff;
            color: white;
            text-align: center;
            padding: 20px;
        }

        nav {
            background-color: #333;
            color: white;
            padding: 10px;
            text-align: center;
        }

        nav a {
            color: white;
            margin: 0 10px;
            text-decoration: none;
        }

        nav a:hover {
            text-decoration: underline;
        }

        section {
            max-width: 900px;
            margin: 30px auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #444;
        }

        /* 공통 버튼 스타일 */
        button {
            background-color: #6c63ff;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #5a4db8;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .hidden {
            display: none;
        }

        footer {
            background-color: #6c63ff;
            color: white;
            text-align: center;
            padding: 10px;
            margin-top: 30px;
        }

        /* 에티켓 슬라이드 */
        #etiquette-slide {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            background: #f9f9f9;
            display: flex;
            justify-content: space-between;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        .etiquette-item {
            flex: 1;
            text-align: center;
        }

        .etiquette-item img {
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <header>
        <h1>지하철 통합 웹사이트</h1>
    </header>

    <nav>
        <a href="#favorites">광고 및 즐겨찾기</a>
        <a href="#elderly">노약자 좌석 검색</a>
        <a href="#map">지도 검색</a>
        <a href="#survey">설문조사</a>
        <a href="#community">익명 게시판</a>
        <a href="#faq">FAQ</a>
        <a href="#etiquette">에티켓 홍보</a>
    </nav>

    <!-- 광고 및 즐겨찾기 -->
    <section id="favorites">
        <h2>광고 및 즐겨찾기</h2>
        <input type="text" id="station-search" placeholder="역 이름 입력">
        <button id="search-button">검색</button>
        <button id="add-favorite-button">즐겨찾기에 추가</button>
        <div id="favorites-container"></div>
        <div id="ad-container">
            <h3>맞춤형 광고</h3>
            <p id="ad-content">광고 내용이 여기에 표시됩니다.</p>
        </div>
    </section>

    <!-- 노약자 좌석 검색 -->
    <section id="elderly">
        <h2>노약자 좌석 검색</h2>
  <div class="search-container">
    <label for="station-search">역 이름 검색:</label>
    <input type="text" id="station-search" placeholder="예: 강남역">
    <button id="search-button">검색</button>
    <button id="add-favorite-button">즐겨찾기에 추가</button>
  </div>

  <div class="favorites-container" id="favorites-container">
    <h3>즐겨찾기</h3>
    <p>즐겨찾은 역이 여기에 표시됩니다.</p>
  </div>

  <div class="result">
    <h3>검색 결과</h3>
    <div id="result">검색 결과가 여기에 표시됩니다.</div>
  </div>

  <div class="ad-container" id="ad-container">
    <h3>맞춤형 광고</h3>
    <p id="ad-content">광고가 여기에 표시됩니다.</p>
  </div>

  <script>
    let jsonData;

    // JSON 파일 로드
    fetch('./승객_예상_데이터.json')
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        jsonData = data;
        console.log("JSON 데이터 로드 성공:", jsonData);
      })
      .catch(error => console.error("JSON 데이터 로드 실패:", error));

    // 현재 요일과 시간대 계산 함수
    function getCurrentDayAndTimeSlot() {
      const now = new Date();
      const days = ["일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일"];
      const day = days[now.getDay()];
      const hour = now.getHours();
      const timeSlot = `${hour.toString().padStart(2, '0')}-${(hour + 1).toString().padStart(2, '0')}시간대`;
      return { day, timeSlot };
    }

    // 즐겨찾기 데이터
    let favorites = [];

    // 즐겨찾기 업데이트 함수
    function updateFavorites() {
      const favoritesContainer = document.getElementById('favorites-container');
      favoritesContainer.innerHTML = '<h3>즐겨찾기</h3>';

      favorites.forEach((station, index) => {
        const buttonWrapper = document.createElement('div');
        buttonWrapper.style.marginBottom = '10px';

        const button = document.createElement('button');
        button.textContent = station;
        button.addEventListener('click', () => {
          document.getElementById('station-search').value = station;
          document.getElementById('search-button').click();
        });

        const removeButton = document.createElement('button');
        removeButton.textContent = '❌';
        removeButton.addEventListener('click', () => {
          favorites.splice(index, 1);
          updateFavorites();
        });

        buttonWrapper.appendChild(button);
        buttonWrapper.appendChild(removeButton);
        favoritesContainer.appendChild(buttonWrapper);
      });
    }

    // 즐겨찾기 추가 버튼 이벤트
    document.getElementById('add-favorite-button').addEventListener('click', () => {
      const stationName = document.getElementById('station-search').value.trim();

      if (!stationName) {
        alert('역 이름을 입력해주세요!');
        return;
      }
      if (favorites.includes(stationName)) {
        alert('이미 즐겨찾기에 추가된 역입니다!');
        return;
      }
      if (favorites.length >= 3) {
        alert('즐겨찾기는 최대 3개까지만 추가할 수 있습니다.');
        return;
      }

      favorites.push(stationName);
      updateFavorites();
    });

    // 검색 버튼 클릭 이벤트
    document.getElementById('search-button').addEventListener('click', () => {
      const stationName = document.getElementById('station-search').value.trim();

      if (!stationName) {
        document.getElementById('result').textContent = "역 이름을 입력해주세요.";
        return;
      }

      if (!jsonData) {
        document.getElementById('result').textContent = "JSON 데이터가 아직 로드되지 않았습니다.";
        return;
      }

      // 현재 요일과 시간대 계산
      const { day, timeSlot } = getCurrentDayAndTimeSlot();

      // JSON 데이터 필터링
      const results = jsonData.filter(item =>
        item.역명 === stationName && item.요일 === day
      );

      if (results.length === 0) {
        document.getElementById('result').textContent = "해당 조건에 맞는 데이터가 없습니다.";
        return;
      }

      // 시간대 데이터 추출
      const output = results.map(item => ({
        유형: item.승객유형,
        인원수: item[timeSlot] || "데이터 없음"
      }));

      // 결과 표시
      let resultHtml = `<strong>${stationName}</strong> (${day}, ${timeSlot}):<br>`;
      output.forEach(item => {
        resultHtml += `- ${item.유형}: ${item.인원수}<br>`;
      });
      document.getElementById('result').innerHTML = resultHtml;

      // 맞춤형 광고 표시
      const highestType = output.reduce((a, b) => {
        if (a && b) return a.인원수 > b.인원수 ? a : b;
        return b;
      }, null)?.유형;

      const ads = {
        일반: "일반인을 위한 지하철 안전 캠페인 광고",
        어린이: "어린이를 위한 지하철 예절 광고",
        청소년: "청소년을 위한 특별 프로모션 광고"
      };

      const adContent = document.getElementById('ad-content');
      adContent.textContent = ads[highestType] || "광고 데이터가 없습니다.";

      // 광고 이미지 표시
      const adImages = {
        일반: ["./img/일반광고-1.png", "./img/일반광고-2.png"],
        어린이: ["./img/어린이광고-1.png", "./img/어린이광고-2.png"],
        청소년: ["./img/청소년광고-1.png", "./img/청소년광고-2.png"]
      };

      if (highestType && adImages[highestType]) {
        const randomImage = adImages[highestType][Math.floor(Math.random() * adImages[highestType].length)];
        const adImageElement = document.createElement('img');
        adImageElement.src = randomImage;
        adImageElement.alt = `${highestType} 광고 이미지`;
        adImageElement.style.maxWidth = "100%";

        // 기존 이미지 제거 후 새로운 이미지 추가
        const existingImage = adContent.nextElementSibling;
        if (existingImage) {
          existingImage.remove();
        }
        adContent.insertAdjacentElement('afterend', adImageElement);
      }
    });
  </script>
    </section>

    <!-- 지도 검색 -->
    <section id="map">
        <h2>지도 검색</h2>
        <input type="text" id="map-search-input" placeholder="검색어 입력">
        <button id="map-search-button">검색</button>
        <div id="map-container" style="height: 300px;"></div>
        <div id="map-results"></div>
    </section>

    <!-- 설문조사 -->
    <section id="survey">
        <h2>설문조사</h2>
            <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7fa;
            color: #333;
        }

        /* 지도 스타일 */
        #map {
            width: 100%;
            height: 500px;
            max-width: 100%;
            margin: 0 auto;
            display: block;
        }

        /* 검색 박스 */
        #search-box {
            margin: 20px auto;
            text-align: center;
            max-width: 800px;
            width: 100%;
        }

        #search-input {
            width: 70%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-right: 10px;
        }

        #search-button {
            padding: 10px 20px;
            background-color: #6c63ff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        #search-button:hover {
            background-color: #5a4db8;
        }

        /* 검색 결과 리스트 스타일 */
        #results {
            margin: 20px auto;
            padding: 10px;
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
        }

        .result-item {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #ddd;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .result-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .result-item a {
            text-decoration: none;
            color: #6c63ff;
            font-weight: bold;
        }

        .result-item a:hover {
            text-decoration: underline;
        }

        .result-item p {
            margin: 5px 0;
        }

        /* 화면 반응형 설정 */
        @media (max-width: 768px) {
            #search-input {
                width: 60%;
            }
            #search-button {
                width: 30%;
            }
        }

    </style>
</head>
<body>

    <div id="search-box">
        <input type="text" id="search-input" placeholder="검색어를 입력하세요" />
        <button id="search-button">검색</button>
    </div>

    <div id="map"></div>

    <div id="results"></div>

    <script>
        let currentLat = 37.5665, currentLng = 126.9780;  // 서울시청 좌표 (예시로 서울시청을 사용)

        // 네이버 지도 초기화
        const map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(currentLat, currentLng), // 서울 중심
            zoom: 12
        });

        // 사용자 위치를 임의로 설정 (예: 서울시청)
        const userMarker = new naver.maps.Marker({
            position: new naver.maps.LatLng(currentLat, currentLng),
            map: map,
            title: "현재 위치"
        });

        // 검색 API 요청
        async function searchPlaces(query) {
            const proxyUrl = "https://cors-anywhere.herokuapp.com/"; // CORS Proxy URL
            const url = `https://openapi.naver.com/v1/search/local.json?query=${encodeURIComponent(query)}&display=5&start=1&sort=random`;

            try {
                const response = await fetch(proxyUrl + url, {
                    headers: {
                        "X-Naver-Client-Id": "2il85btNfU6KvdvFEPYu",
                        "X-Naver-Client-Secret": "y4iSS_jPQq"
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayResults(data.items); // 검색 결과를 화면에 표시
                } else {
                    alert("검색 결과를 불러오는 데 실패했습니다.");
                }
            } catch (error) {
                console.error("Error:", error);
                alert("API 요청 중 오류가 발생했습니다.");
            }
        }

        // 두 지점 간의 거리 계산 (Haversine Formula)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // 지구 반지름 (킬로미터)
            const dLat = toRad(lat2 - lat1);
            const dLng = toRad(lng2 - lng1);
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + 
                      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * 
                      Math.sin(dLng / 2) * Math.sin(dLng / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // 거리(km)
        }

        function toRad(deg) {
            return deg * (Math.PI / 180);
        }

        // 검색 결과를 지도와 페이지에 표시하는 함수
        function displayResults(places) {
            // 이전 결과 초기화
            document.getElementById("results").innerHTML = "";

            // 마커 배열
            const markers = [];

            places.forEach(place => {
                // mapy, mapx 값이 있는지 확인
                if (place.mapy && place.mapx) {
                    const distance = calculateDistance(currentLat, currentLng, place.mapy, place.mapx);
                    
                    // 10km 이내의 장소만 필터링
                    if (distance <= 10) {
                        // 지도에 마커 추가
                        const marker = new naver.maps.Marker({
                            position: new naver.maps.LatLng(place.mapy, place.mapx),
                            map: map,
                            title: place.title.replace(/<[^>]+>/g, "") // HTML 태그 제거
                        });

                        // 마커 클릭 이벤트 (정보창 표시)
                        const infoWindow = new naver.maps.InfoWindow({
                            content: `<div><strong>${place.title}</strong><br>${place.address}</div>`
                        });

                        naver.maps.Event.addListener(marker, "click", () => {
                            infoWindow.open(map, marker);
                        });

                        // 마커 배열에 추가
                        markers.push(marker);

                        // 검색 결과 목록 추가
                        document.getElementById("results").innerHTML += `
                            <div class="result-item">
                                <strong>${place.title.replace(/<[^>]+>/g, "")}</strong><br>
                                ${place.address}<br>
                                <a href="${place.link}" target="_blank">상세보기</a>
                            </div>
                        `;
                    }
                }
            });

            // 지도에 마커 표시
            showMarkers(markers);
        }

        // 마커 표시 함수
        function showMarkers(markers) {
            markers.forEach(marker => {
                marker.setMap(map);  // 마커 표시
            });
        }

        // 검색 버튼 클릭 이벤트
        document.getElementById("search-button").addEventListener("click", () => {
            const query = document.getElementById("search-input").value;
            if (query.trim()) {
                searchPlaces(query.trim()); // 검색 실행
            } else {
                alert("검색어를 입력하세요!");
            }
        });
    </script>

    </section>

    <!-- 익명 게시판 -->
    <section id="community">
        <h2>익명 게시판</h2>
        <textarea id="post-input" placeholder="게시글 작성"></textarea>
        <button id="post-submit">작성</button>
        <div id="posts-container"></div>
    </section>

    <!-- FAQ -->
    <section id="faq">
        <h2>자주 묻는 질문</h2>
<style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f7fa;
            margin: 0;
            padding: 0;
        }

        /* 커뮤니티 영역 스타일 */
        #community-section {
            margin: 40px auto;
            padding: 20px;
            max-width: 800px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        #community-section h2 {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
        }

        /* 게시글 스타일 */
        .post {
            margin-bottom: 20px;
            padding: 15px;
            background: #fafafa;
            border-radius: 8px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .post .content {
            font-size: 16px;
            color: #333;
        }

        .post .comments {
            margin-top: 10px;
            padding-left: 20px;
        }

        .comment {
            margin-top: 5px;
            padding: 10px;
            background: #f1f1f1;
            border-radius: 5px;
            border-left: 5px solid #6c63ff;
        }

        /* 글 작성 영역 */
        .post textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            box-sizing: border-box;
            resize: none;
            font-size: 14px;
        }

        .post button {
            background-color: #6c63ff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }

        .post button:hover {
            background-color: #5a4db8;
        }

        /* 글 작성 입력창 스타일 */
        #post-input {
            width: 100%;
            height: 80px;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            box-sizing: border-box;
            resize: none;
            font-size: 14px;
        }

        #post-button {
            background-color: #6c63ff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }

        #post-button:hover {
            background-color: #5a4db8;
        }

        /* 댓글 버튼 스타일 */
        .comment-button {
            background-color: #6c63ff;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .comment-button:hover {
            background-color: #5a4db8;
        }

    </style>
</head>
<body>
    <!-- 커뮤니티 공간 -->
    <div id="community-section">
        <h2>익명 게시판</h2>
        <div id="posts"></div>
        <div>
            <textarea id="post-input" placeholder="글을 작성해보세요..." style="width: 100%; height: 80px;"></textarea>
            <button id="post-button" style="padding: 5px 10px;">글 작성</button>
        </div>
    </div>

    <script>
        // 커뮤니티 게시글 작성
        let posts = []; // 게시글을 저장하는 배열
        document.getElementById("post-button").addEventListener("click", () => {
            const postContent = document.getElementById("post-input").value.trim();
            if (postContent) {
                const newPost = {
                    id: posts.length + 1,
                    content: postContent,
                    comments: [] // 댓글을 저장할 배열
                };
                posts.push(newPost);
                displayPosts(); // 게시글 새로 고침
                document.getElementById("post-input").value = ""; // 글 입력창 초기화
            } else {
                alert("글을 입력해주세요.");
            }
        });

        // 게시글과 댓글 표시
        function displayPosts() {
            const postsContainer = document.getElementById("posts");
            postsContainer.innerHTML = ""; // 기존 게시글 초기화

            posts.forEach(post => {
                const postDiv = document.createElement("div");
                postDiv.classList.add("post");

                const postTitle = document.createElement("div");
                postTitle.classList.add("content");
                postTitle.textContent = `익명글 ${post.id}: ${post.content}`;
                postDiv.appendChild(postTitle);

                // 댓글 작성 부분
                const commentInput = document.createElement("textarea");
                commentInput.placeholder = "댓글을 작성해보세요...";
                postDiv.appendChild(commentInput);

                const commentButton = document.createElement("button");
                commentButton.classList.add("comment-button");
                commentButton.textContent = "댓글 작성";
                postDiv.appendChild(commentButton);

                // 댓글 작성 기능
                commentButton.addEventListener("click", () => {
                    const commentContent = commentInput.value.trim();
                    if (commentContent) {
                        post.comments.push(commentContent);
                        commentInput.value = ""; // 댓글 입력창 초기화
                        displayPosts(); // 댓글 추가 후 게시글 새로 고침
                    } else {
                        alert("댓글을 입력해주세요.");
                    }
                });

                // 댓글 표시
                const commentsDiv = document.createElement("div");
                commentsDiv.classList.add("comments");
                post.comments.forEach(comment => {
                    const commentDiv = document.createElement("div");
                    commentDiv.classList.add("comment");
                    commentDiv.textContent = comment;
                    commentsDiv.appendChild(commentDiv);
                });
                postDiv.appendChild(commentsDiv);
                postsContainer.appendChild(postDiv);
            });
        }
    </script>

    </section>

    <!-- 에티켓 홍보 -->
    <section id="etiquette">
        <h2>에티켓 홍보</h2>
       <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7fa;
            color: #333;
        }

        /* 배너 스타일 */
        #etiquette-slide {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #f9f9f9;
            padding: 20px 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            z-index: 1000;
        }

        .etiquette-slide-container {
            display: flex;
            animation: slide 20s ease-in-out infinite; /* 20초에 한 번씩 슬라이드 */
            align-items: center;
        }

        .etiquette-item {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: none;
            min-width: 100%;
            text-align: center;
            padding: 0 20px;
        }

        .etiquette-item img {
            width: 100px; /* 이미지 크기 조정 */
            height: 100px;
            margin-right: 20px; /* 이미지와 텍스트 간격 */
            border: 2px solid #6c63ff; /* 테두리 색상 */
            border-radius: 10px; /* 테두리 둥글게 */
        }

        .etiquette-item h3 {
            font-size: 22px; /* 텍스트 크기 조정 */
            margin: 0;
        }

        /* 애니메이션 */
        @keyframes slide {
            0% {
                transform: translateX(100%);
            }
            25% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(-100%);
            }
            75% {
                transform: translateX(-200%);
            }
            100% {
                transform: translateX(-300%);
            }
        }
    </style>
</head>
<body>

    <div id="etiquette-slide">
        <div class="etiquette-slide-container">
            <div class="etiquette-item">
                <img src="https://raw.githubusercontent.com/mihee03/my-website/main/홍보물사진/책가방.png" alt="책가방">
                <h3>붐비는 열차에서는 가방을 앞으로</h3>
            </div>
            <div class="etiquette-item">
                <img src="https://raw.githubusercontent.com/mihee03/my-website/main/홍보물사진/휴대폰 소리.png" alt="휴대폰 소리">
                <h3>큰 소리로 통화하거나 떠들지 않기</h3>
            </div>
            <div class="etiquette-item">
                <img src="https://raw.githubusercontent.com/mihee03/my-website/main/홍보물사진/음식.png" alt="음식">
                <h3>열차 안에서 음식물 먹지 않기</h3>
            </div>
            <div class="etiquette-item">
                <img src="https://raw.githubusercontent.com/mihee03/my-website/main/홍보물사진/넘어짐.png" alt="넘어짐">
                <h3>보행 중이거나 열차 승하차시엔 스마트폰 사용하지 않기</h3>
            </div>
        </div>
    </div>

    </section>

    <footer>
        <p>지하철 통합 웹사이트 - 2024</p>
    </footer>

    <script>
        // 각각의 스크립트를 독립적으로 작성하여 기능 구현
        console.log("전체 기능 통합 완료!");
    </script>
</body>
</html>
