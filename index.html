<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지하철 통합 웹사이트</title>
    <style>
        /* 기본 스타일 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7fa;
            color: #333;
        }

        header {
            background-color: #6c63ff;
            color: white;
            text-align: center;
            padding: 20px;
        }

        section {
            max-width: 900px;
            margin: 30px auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #444;
        }

        footer {
            background-color: #6c63ff;
            color: white;
            text-align: center;
            padding: 10px;
            margin-top: 30px;
        }

        /* 광고 및 즐겨찾기 스타일 */
        #favorites {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .search-container {
            margin-bottom: 20px;
        }
        .favorites-container button {
            margin: 5px;
        }
        .result {
            margin-top: 20px;
        }
        img {
            display: block;
            margin-top: 10px;
        }

        /* 노약자 좌석 검색 스타일 */
        #elderly {
            max-width: 600px;
            margin: 30px auto;
            padding: 20px;
            background: #ffffff;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        #elderly label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }

        #elderly input {
            width: 100%;
            padding: 10px;
            margin: 5px 0 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }

        #elderly button {
            width: 100%;
            background: #007BFF;
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        #elderly button:hover {
            background: #0056b3;
        }

        #results {
            margin-top: 20px;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid #007BFF;
            border-radius: 4px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
    <header>
        <h1>지하철 통합 웹사이트</h1>
    </header>

    <!-- 광고 및 즐겨찾기 -->
    <section id="favorites">
        <h2>광고 및 즐겨찾기</h2>
        <div class="search-container">
            <label for="station-search">역 이름 검색:</label>
            <input type="text" id="station-search" placeholder="예: 강남역">
            <button id="search-button">검색</button>
            <button id="add-favorite-button">즐겨찾기에 추가</button>
        </div>

        <div class="favorites-container" id="favorites-container">
            <h3>즐겨찾기</h3>
            <p>즐겨찾은 역이 여기에 표시됩니다.</p>
        </div>

        <div class="result">
            <h3>검색 결과</h3>
            <div id="result">검색 결과가 여기에 표시됩니다.</div>
        </div>

        <div class="ad-container" id="ad-container">
            <h3>맞춤형 광고</h3>
            <p id="ad-content">광고가 여기에 표시됩니다.</p>
        </div>
    </section>

    <!-- 노약자 좌석 검색 -->
    <section id="elderly">
        <h2>노약자 좌석 검색</h2>
        <label for="date">Enter Date (mm-dd):</label>
        <input type="text" id="date" placeholder="01-01">

        <label for="hour">Enter Hour (0-23):</label>
        <input type="number" id="hour" placeholder="6" min="0" max="23">

        <label for="station">Enter Station Name:</label>
        <input type="text" id="station" placeholder="서울역">

        <button id="search">Search</button>

        <div id="results"></div>
    </section>

    <footer>
        <p>지하철 통합 웹사이트 - 2024</p>
    </footer>

    <script>
        /* 광고 및 즐겨찾기 기능 */
        let jsonData;
        fetch('./승객_예상_데이터.json')
            .then(response => response.json())
            .then(data => jsonData = data)
            .catch(console.error);

        let favorites = [];
        document.getElementById('add-favorite-button').addEventListener('click', () => {
            const station = document.getElementById('station-search').value.trim();
            if (!station || favorites.includes(station) || favorites.length >= 3) return;
            favorites.push(station);
            updateFavorites();
        });

        function updateFavorites() {
            const container = document.getElementById('favorites-container');
            container.innerHTML = '<h3>즐겨찾기</h3>';
            favorites.forEach((station, index) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <button onclick="search('${station}')">${station}</button>
                    <button onclick="favorites.splice(${index}, 1); updateFavorites()">❌</button>`;
                container.appendChild(div);
            });
        }

        function search(station) {
            if (!jsonData) return;
            const { day, timeSlot } = (() => {
                const now = new Date();
                return { 
                    day: ["일", "월", "화", "수", "목", "금", "토"][now.getDay()], 
                    timeSlot: `${now.getHours()}-${now.getHours() + 1}` 
                };
            })();
            const result = jsonData.filter(r => r.역명 === station && r.요일 === day);
            const output = result.map(r => `${r.승객유형}: ${r[timeSlot] || "데이터 없음"}`).join("<br>");
            document.getElementById('result').innerHTML = `<strong>${station}</strong><br>${output}`;
        }

        document.getElementById('search-button').addEventListener('click', () => {
            const station = document.getElementById('station-search').value.trim();
            search(station);
        });

        /* 노약자 좌석 검색 */
        let data = [];
        const loadCSV = url => new Promise((resolve, reject) =>
            Papa.parse(url, { download: true, header: true, complete: r => resolve(r.data), error: reject }));

        Promise.all([loadCSV('file1.csv'), loadCSV('file2.csv')])
            .then(([d1, d2]) => data = d1.concat(d2));

        document.getElementById('search').addEventListener('click', () => {
            const station = document.getElementById('station').value.trim();
            const date = document.getElementById('date').value;
            const hour = +document.getElementById('hour').value;
            const filtered = data.filter(d => d.역명 === station && new Date(d.일시).getHours() === hour);
            const totalPassengers = filtered.reduce((sum, d) => sum + +d.인원수, 0);
            document.getElementById('results').innerHTML = totalPassengers > 170 
                ? 'Elderly seats: 27' : 'Elderly seats: 12';
        });
    </script>
</body>
</html>
