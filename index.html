<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>통합 지하철 웹사이트</title>
    <style>
        /* 광고 및 즐겨찾기 스타일 */
        #favorites {
          font-family: Arial, sans-serif;
          margin: 0;
          padding: 0;
          background-color: #f0f0f0; /* 전체 배경 회색 */
          color: #333;
        }

        h1 {
          text-align: center;
          padding: 20px 0;
          background-color: #666; /* 헤더 배경 진한 회색 */
          color: #fff;
          margin: 0;
          font-size: 24px;
        }

        .container {
          max-width: 800px;
          margin: 20px auto;
          padding: 20px;
          background: #fff;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          border-radius: 8px;
        }

        .search-container, .favorites-container, .result, .ad-container {
          margin-bottom: 20px;
        }

        label {
          display: block;
          margin-bottom: 8px;
          font-weight: bold;
        }

        input {
          width: 100%;
          padding: 10px;
          border: 1px solid #ccc;
          border-radius: 5px;
          margin-bottom: 10px;
          box-sizing: border-box;
          font-size: 16px;
        }

        button {
          background-color: #666; /* 버튼 회색 */
          color: white;
          border: none;
          padding: 10px 15px;
          font-size: 16px;
          border-radius: 5px;
          cursor: pointer;
          margin-right: 10px;
          transition: background 0.3s ease;
        }

        button:hover {
          background-color: #444; /* 버튼 호버 시 더 진한 회색 */
        }

        .favorites-container {
          padding: 10px;
          background: #f9f9f9; /* 연한 회색 배경 */
          border: 1px solid #ddd;
          border-radius: 5px;
        }

        .favorites-container button {
          background-color: #999;
          color: white;
          margin: 5px 0;
        }

        .favorites-container button:hover {
          background-color: #777;
        }

        .result, .ad-container {
          padding: 15px;
          background: #f9f9f9;
          border: 1px solid #ddd;
          border-radius: 5px;
        }

        .result h3, .ad-container h3 {
          margin-top: 0;
          color: #555;
        }

        .ad-container img {
          display: block;
          margin: 10px auto 0;
          max-width: 100%;
          border-radius: 5px;

        }
        /* 노약자 좌석 스타일 */
        #elderly-seats {
            /* 직접추가: 노약자 좌석 스타일 */
        }
        /* 지하철 검색 스타일 */
        #search {
            /* 직접추가: 검색 기능 스타일 */
        }
        /* 설문조사 스타일 */
        #survey {
            /* 직접추가: 설문조사 스타일 */
        }
        /* 익명 게시판 스타일 */
        #community {
            /* 직접추가: 익명 게시판 스타일 */
        }
        /* 자주 묻는 질문 스타일 */
        #faq {
            /* 직접추가: 자주 묻는 질문 스타일 */
        }
        /* 에티켓 홍보 스타일 */
        #etiquette {
            /* 직접추가: 에티켓 홍보 스타일 */
        }
    </style>
</head>
<body>
    <header>
        <h1>지하철 통합 서비스</h1>
        <nav>
            <ul>
                <li><a href="#favorites">광고 및 즐겨찾기</a></li>
                <li><a href="#elderly-seats">노약자 좌석</a></li>
                <li><a href="#search">지하철 검색</a></li>
                <li><a href="#survey">설문조사</a></li>
                <li><a href="#community">익명 게시판</a></li>
                <li><a href="#faq">자주 묻는 질문</a></li>
                <li><a href="#etiquette">에티켓 홍보</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section id="favorites">
            <h2>광고 및 즐겨찾기</h2>
            <div class="container">
                <!-- 검색 영역 -->
                <div class="search-container">
                  <label for="station-search">역 이름 검색:</label>
                  <input type="text" id="station-search" placeholder="예: 강남역">
                  <button id="search-button">검색</button>
                  <button id="add-favorite-button">즐겨찾기에 추가</button>
                </div>

                <!-- 즐겨찾기 영역 -->
                <div class="favorites-container" id="favorites-container">
                  <h3>즐겨찾기</h3>
                  <p>즐겨찾은 역이 여기에 표시됩니다.</p>
                </div>

                <!-- 검색 결과 영역 -->
                <div class="result">
                  <h3>검색 결과</h3>
                  <div id="result">검색 결과가 여기에 표시됩니다.</div>
                </div>

                <!-- 광고 영역 -->
                <div class="ad-container" id="ad-container">
                  <h3>맞춤형 광고</h3>
                  <p id="ad-content">광고가 여기에 표시됩니다.</p>
                </div>
              </div>

              <script>
                // JavaScript 로직은 요청하신 코드 그대로 사용합니다.
                let jsonData;

                // JSON 파일 로드
                fetch('./승객_예상_데이터.json')
                  .then(response => {
                    if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                  })
                  .then(data => {
                    jsonData = data;
                    console.log("JSON 데이터 로드 성공:", jsonData);
                  })
                  .catch(error => console.error("JSON 데이터 로드 실패:", error));

                // 현재 요일과 시간대 계산 함수
                function getCurrentDayAndTimeSlot() {
                  const now = new Date();
                  const days = ["일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일"];
                  const day = days[now.getDay()];
                  const hour = now.getHours();
                  const timeSlot = `${hour.toString().padStart(2, '0')}-${(hour + 1).toString().padStart(2, '0')}시간대`;
                  return { day, timeSlot };
                }

                // 즐겨찾기 데이터
                let favorites = [];

                // 즐겨찾기 업데이트 함수
                function updateFavorites() {
                  const favoritesContainer = document.getElementById('favorites-container');
                  favoritesContainer.innerHTML = '<h3>즐겨찾기</h3>';

                  favorites.forEach((station, index) => {
                    const buttonWrapper = document.createElement('div');
                    buttonWrapper.style.marginBottom = '10px';

                    const button = document.createElement('button');
                    button.textContent = station;
                    button.addEventListener('click', () => {
                      document.getElementById('station-search').value = station;
                      document.getElementById('search-button').click();
                    });

                    const removeButton = document.createElement('button');
                    removeButton.textContent = '❌';
                    removeButton.addEventListener('click', () => {
                      favorites.splice(index, 1);
                      updateFavorites();
                    });

                    buttonWrapper.appendChild(button);
                    buttonWrapper.appendChild(removeButton);
                    favoritesContainer.appendChild(buttonWrapper);
                  });
                }

                // 즐겨찾기 추가 버튼 이벤트
                document.getElementById('add-favorite-button').addEventListener('click', () => {
                  const stationName = document.getElementById('station-search').value.trim();

                  if (!stationName) {
                    alert('역 이름을 입력해주세요!');
                    return;
                  }
                  if (favorites.includes(stationName)) {
                    alert('이미 즐겨찾기에 추가된 역입니다!');
                    return;
                  }
                  if (favorites.length >= 3) {
                    alert('즐겨찾기는 최대 3개까지만 추가할 수 있습니다.');
                    return;
                  }

                  favorites.push(stationName);
                  updateFavorites();
                });

                // 검색 버튼 클릭 이벤트
                document.getElementById('search-button').addEventListener('click', () => {
                  const stationName = document.getElementById('station-search').value.trim();

                  if (!stationName) {
                    document.getElementById('result').textContent = "역 이름을 입력해주세요.";
                    return;
                  }

                  if (!jsonData) {
                    document.getElementById('result').textContent = "JSON 데이터가 아직 로드되지 않았습니다.";
                    return;
                  }

                  // 현재 요일과 시간대 계산
                  const { day, timeSlot } = getCurrentDayAndTimeSlot();

                  // JSON 데이터 필터링
                  const results = jsonData.filter(item =>
                    item.역명 === stationName && item.요일 === day
                  );

                  if (results.length === 0) {
                    document.getElementById('result').textContent = "해당 조건에 맞는 데이터가 없습니다.";
                    return;
                  }

                  // 시간대 데이터 추출
                  const output = results.map(item => ({
                    유형: item.승객유형,
                    인원수: item[timeSlot] || "데이터 없음"
                  }));

                  // 결과 표시
                  let resultHtml = `<strong>${stationName}</strong> (${day}, ${timeSlot}):<br>`;
                  output.forEach(item => {
                    resultHtml += `- ${item.유형}: ${item.인원수}<br>`;
                  });
                  document.getElementById('result').innerHTML = resultHtml;

                  // 맞춤형 광고 표시
                  const highestType = output.reduce((a, b) => {
                    if (a && b) return a.인원수 > b.인원수 ? a : b;
                    return b;
                  }, null)?.유형;

                  const ads = {
                    일반: "일반인을 위한 지하철 안전 캠페인 광고",
                    어린이: "어린이를 위한 지하철 예절 광고",
                    청소년: "청소년을 위한 특별 프로모션 광고"
                  };

                  const adContent = document.getElementById('ad-content');
                  adContent.textContent = ads[highestType] || "광고 데이터가 없습니다.";

                  // 광고 이미지 표시
                  const adImages = {
                    일반: ["./img/일반광고-1.png", "./img/일반광고-2.png"],
                    어린이: ["./img/어린이광고-1.png", "./img/어린이광고-2.png"],
                    청소년: ["./img/청소년광고-1.png", "./img/청소년광고-2.png"]
                  };

                  if (highestType && adImages[highestType]) {
                    const randomImage = adImages[highestType][Math.floor(Math.random() * adImages[highestType].length)];
                    const adImageElement = document.createElement('img');
                    adImageElement.src = randomImage;
                    adImageElement.alt = `${highestType} 광고 이미지`;
                    adImageElement.style.maxWidth = "100%";

                    // 기존 이미지 제거 후 새로운 이미지 추가
                    const existingImage = adContent.nextElementSibling;
                    if (existingImage) {
                      existingImage.remove();
                    }
                    adContent.insertAdjacentElement('afterend', adImageElement);
                  }
                });
            </script>
        </body>
        </section>
        <section id="elderly-seats">
            <h2>노약자 좌석</h2>
                <div class="container">
                    <label for="date">Enter Date (mm-dd):</label>
                    <input type="text" id="date" placeholder="01-01">

                    <label for="hour">Enter Hour (6-23):</label>
                    <input type="number" id="hour" placeholder="6" min="0" max="23">

                    <label for="station">Enter Station Name:</label>
                    <input type="text" id="station" placeholder="예:서울역">

                    <button id="search">Search</button>

                    <div id="results"></div>
                </div>

                <script>
                    let data = [];
                    let stationList = []; // 모든 역명을 저장할 배열

                    // CSV 파일 로드 및 병합
                    const loadCSV = async (url) => {
                        return new Promise((resolve, reject) => {
                            Papa.parse(url, {
                                download: true,
                                header: true,
                                complete: function(results) {
                                    resolve(results.data);
                                },
                                error: function(error) {
                                    reject(error);
                                }
                            });
                        });
                    };

                    // 데이터 파일 경로
                    const file1 = "데이터파일/우대권병합데이터06.csv";
                    const file2 = "데이터파일/우대권병합데이터12.csv";

                    // 파일 로드 및 병합
                    Promise.all([loadCSV(file1), loadCSV(file2)]).then(results => {
                        data = results[0].concat(results[1]); // 두 파일 병합
                        stationList = [...new Set(data.map(row => row['역명'] ? row['역명'].trim() : ""))].filter(Boolean);
                        console.log("Station list:", stationList);
                        alert("CSV Files Loaded!");
                    }).catch(error => {
                        console.error("Error loading files:", error);
                    });

                    // 검색 버튼 클릭 이벤트
                    document.getElementById('search').addEventListener('click', function() {
                        const inputDate = document.getElementById('date').value; // 날짜 입력
                        const inputHour = document.getElementById('hour').value; // 시간 입력
                        const stationName = document.getElementById('station').value.trim(); // 역명 입력

                        if (!inputDate || !inputHour || !stationName) {
                            document.getElementById('results').textContent = "날짜, 시간, 역명을 모두 입력해주세요.";
                            return;
                        }

                        document.getElementById('results').textContent = "검색 중...";

                        setTimeout(() => {
                            if (!stationList.some(station => station.toLowerCase() === stationName.toLowerCase())) {
                                alert("올바른 역명을 입력하세요.");
                                document.getElementById('results').textContent = "";
                                return;
                            }

                            const filteredData = data.filter(row => {
                                const rowDate = row['일시'] ? new Date(row['일시']).toLocaleDateString('en-CA').slice(5) : "";
                                const rowHour = row['일시'] ? new Date(row['일시']).getHours() : null;
                                const rowStation = row['역명'] ? row['역명'].trim() : "";
                                return rowDate === inputDate && rowHour == inputHour && rowStation.toLowerCase() === stationName.toLowerCase();
                            });

                            const totalPassengers = filteredData.reduce((sum, row) => sum + parseInt(row['인원수'] || 0), 0);
                            const elderlySeatCount = totalPassengers >= 170 ? 27 : 12;

                            if (filteredData.length > 0) {
                                document.getElementById('results').innerHTML = `
                                    <p><strong>Station:</strong> ${stationName}</p>
                                    <p><strong>Date:</strong> ${inputDate}</p>
                                    <p><strong>Hour:</strong> ${inputHour}:00</p>
                                    <p><strong>Total Passengers:</strong> ${totalPassengers}</p>
                                    <p><strong>Elderly Seats:</strong> ${elderlySeatCount} seats</p>
                                `;
                            } else {
                                document.getElementById('results').innerHTML = `
                                    <p>No data found for station: ${stationName}</p>
                                    <p>on date: ${inputDate} at hour: ${inputHour}:00</p>
                                `;
                            }
                        }, 1000);
                    });
                </script>
            </body>
        </section>
        <section id="search">
            <h2>지하철 검색</h2>
            <!-- 직접추가: 검색 기능 HTML -->
        </section>
        <section id="survey">
            <h2>설문조사</h2>
            <!-- 직접추가: 설문조사 HTML -->
        </section>
        <section id="community">
            <h2>익명 게시판</h2>
            <!-- 직접추가: 익명 게시판 HTML -->
        </section>
        <section id="faq">
            <h2>자주 묻는 질문</h2>
            <!-- 직접추가: 자주 묻는 질문 HTML -->
        </section>
        <section id="etiquette">
            <h2>에티켓 홍보</h2>
            <!-- 직접추가: 에티켓 홍보 HTML -->
        </section>
    </main>
    <footer>
        <p>© 2024 지하철 통합 서비스</p>
    </footer>
    <script>
        // 광고 및 즐겨찾기 스크립트
        // 직접추가: 광고 및 즐겨찾기 관련 스크립트

        // 노약자 좌석 스크립트
        // 직접추가: 노약자 좌석 관련 스크립트

        // 지하철 검색 스크립트
        // 직접추가: 검색 기능 관련 스크립트

        // 설문조사 스크립트
        // 직접추가: 설문조사 관련 스크립트

        // 익명 게시판 스크립트
        // 직접추가: 익명 게시판 관련 스크립트

        // 자주 묻는 질문 스크립트
        // 직접추가: 자주 묻는 질문 관련 스크립트

        // 에티켓 홍보 스크립트
        // 직접추가: 에티켓 홍보 관련 스크립트
    </script>
</body>
</html>
